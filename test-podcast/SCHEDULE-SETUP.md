# Windows 11 タスクスケジューラの設定方法

セキュリティポッドキャスト生成を毎朝8時に自動実行するための設定手順です。

## 前提条件

1. スクリプトが正常に動作することを確認してください
2. OpenAI APIキーが `.env` ファイルに正しく設定されていることを確認してください
3. `ffmpeg` がシステムにインストールされ、PATHに追加されていることを確認してください

## タスクスケジューラの設定手順

1. **タスクスケジューラを開く**:
   - スタートメニューで「タスクスケジューラ」と検索して開くか、
   - `Win + R` キーを押して `taskschd.msc` と入力して開きます

2. **新しいタスクの作成**:
   - 右側の「アクション」パネルから「基本タスクの作成」をクリックします
   
3. **名前と説明の入力**:
   - 名前: `SecurityPodcastGenerator`
   - 説明: `毎朝8時にセキュリティポッドキャストを生成する`
   - 「次へ」をクリック

4. **トリガーの設定**:
   - 「毎日」を選択し、「次へ」をクリック
   - 開始日時を設定（現在の日付、時刻を8:00に設定）
   - 「毎日」を選択
   - 「次へ」をクリック

5. **操作の設定**:
   - 「プログラムの開始」を選択し、「次へ」をクリック

6. **プログラムの設定**:
   - プログラム/スクリプト: `C:\Users\takky\OneDrive\デスクトップ\code_work\code_woek\test-podcast\run_podcast.bat`
   - 引数: （空白のままでOK）
   - 開始: `C:\Users\takky\OneDrive\デスクトップ\code_work\code_woek\test-podcast`
   - 「次へ」をクリック

7. **詳細設定（オプション）**:
   - 「タスクの作成時に詳細プロパティを開く」にチェックを入れ、「完了」をクリック
   - 「全般」タブで以下を設定:
     - 「ユーザーがログオンしているかどうかにかかわらず実行する」を選択
     - 「最上位の特権で実行する」にチェックを入れる
   - 「条件」タブで:
     - 「コンピュータをAC電源で使用している場合のみタスクを開始する」のチェックを外す（ノートPCの場合）
   - 「設定」タブで:
     - 「タスクが既に実行中の場合は、次のルールを適用する: 新しいインスタンスを停止する」を選択
   - 「OK」をクリックして設定を保存

8. **タスクの検証**:
   - 作成したタスクを右クリックして「実行」を選択し、正常に動作することを確認してください
   - 実行結果は `podcast_run_log.txt` で確認できます

## トラブルシューティング

タスクが実行されない場合:

1. **権限の問題**: 
   - タスクを右クリックして「プロパティ」を開き、「全般」タブで「最上位の特権で実行する」にチェックが入っていることを確認
   - 実行アカウントが管理者権限を持っていることを確認

2. **パスの問題**:
   - バッチファイルやプログラムの完全なパスが正しいか確認
   - スペースを含むパスは引用符で囲まれているか確認

3. **環境変数の問題**:
   - `.env` ファイルが正しく読み込まれているか確認
   - システム環境変数として OpenAI API キーを設定することも検討

4. **ログの確認**:
   - `podcast_run_log.txt` や `podcast_generator.log` でエラーメッセージを確認

## 注意事項

- OpenAI APIの使用には費用が発生します。毎日自動実行することで予期せぬ料金が発生する可能性があるため、使用状況を定期的に確認してください。
- 長期間コンピュータを使用しない場合は、タスクを一時的に無効化することを検討してください。
